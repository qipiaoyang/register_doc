<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>登记</title>
  <link rel="stylesheet" href="../css/index.css">
</head>
<body>
  <div class="test">
    asasdasdasd
  </div>
  <form action="" method="post" class="register">
    <div>
      <label>姓名</label> <input name="name" />
    </div>
    <div>
      <label>性别 </label> <span> <label> <input type="radio" name="gender" value="1" checked />男</label> <label> <input type="radio" name="gender" value="2" />女</label> </span>
    </div>
    <div>
      <label>手机号码</label> <input name="phone" />
    </div>
    <div>
      <label>地址</label> <input name="addr" />
    </div>
    <div>
      <label>部门</label> <input name="buMen" />
    </div>
    <div>
      <label>职务</label> <input name="zhiWu" />
    </div>
    <div>
      <label>是否住宿</label> <input type="checkbox" name="zhuSu" />
    </div>
    <div>
      <label>单位名称</label> <input name="danWeiName" />
    </div>
    <div>
      <label>单位地址</label> <input name="danWeiAddr" />
    </div>
    <div>
      <label>是否要发票</label> <input type="checkbox" name="invoice" />
    </div>
    <div>
      <label>发票抬头</label> <input name="invoiceTitle" />
    </div>
    <div>
      <label>发票类型</label> <span> <label> <input type="radio" name="invoiceType" value="0" checked />普票</label> <label> <input type="radio" name="invoiceType" value="1" />专票</label> </span>
    </div>
    <div>
      <label>税号</label> <input name="taxNum" />
    </div>
    <div>
      <label>开户银行</label> <input name="bank" />
    </div>
    <div>
      <label>开户银行账号</label> <input name="bankAccount" />
    </div>
    <div>
      <label>职称</label> <input name="zhiCheng" />
    </div>
    <div>
      <label>班次</label> <input name="banCi" />
    </div>
    <button type="reset" name="reset">取消</button>
    <button type="submit" name="submit">提交</button>
  </form>
  <script src="/lib/jquery-3.3.1.min.js"></script>
  <script>
    jQuery(function ($) {
      $("form.register button[name='submit']").click(function (e) {
        e.preventDefault();
        e.stopPropagation();
        var form = $("form.register");

        var name = form.find("input[name=name]").val().trim();
        if (!name) { alert('请填写姓名'); return false; }

        var gender = form.find("input[name='gender']:checked").val();
        if (!gender) { alert('请选择性别'); return false; }

        var phone = form.find("input[name='phone']").val().trim();
        if (!phone) { alert('请填写手机号码'); return false; }

        var addr = form.find("input[name='addr']").val().trim();
        if (!addr) { alert('请填写地址'); return false; }

        var buMen = form.find("input[name='buMen']").val().trim();
        if (!buMen) { alert('请填写部门'); return false; }

        var zhiWu = form.find("input[name='zhiWu']").val().trim();
        if (!zhiWu) { alert('请填写职务'); return false; }

        var zhuSu = form.find("input[name='zhuSu']").prop("checked");
        zhuSu = zhuSu ? 1 : 0;

        var danWeiName = form.find("input[name='danWeiName']").val().trim();
        var danWeiAddr = form.find("input[name='danWeiAddr']").val().trim();

        var invoice = form.find("input[name='invoice']").prop("checked");
        invoice = invoice ? 1 : 0;

        var invoiceTitle = form.find("input[name='invoiceTitle']").val().trim();
        var invoiceType = form.find("input[name='invoiceType']:checked").val();

        var taxNum = form.find("input[name='taxNum']").val().trim();

        var bank = form.find("input[name='bank']").val().trim();
        var bankAccount = form.find("input[name='bankAccount']").val().trim();

        var zhiCheng = form.find("input[name='zhiCheng']").val().trim();
        var banCi = form.find("input[name='banCi']").val().trim();

        var data = {
          name: name,
          gender: gender,
          phone: phone,
          addr: addr,
          buMen: buMen,
          zhiWu: zhiWu,
          zhuSu: zhuSu,
          danWeiName: danWeiName,
          danWeiAddr: danWeiAddr,
          invoice: invoice,
          invoiceTitle: invoiceTitle,
          invoiceType: invoiceType,
          taxNum: taxNum,
          bank: bank,
          bankAccount: bankAccount,
          zhiCheng: zhiCheng,
          banCi: banCi
        };
        $.ajax({
          method: 'post',
          url: '/reg',
          contentType: 'application/json; charset=UTF-8',
          data: JSON.stringify(data),
          dataType: 'json',
          // beforeSend: function (jqXHR, settings) { },
          // complete: function (jqXHR, textStatus) { },
          success: function (data, textStatus, jqXHR) {
            if (parseInt(data.code) < 400) {
              window.location.href='/reg/success';
            } else {
              alert(data.msg || '服务器错误，请稍后重试!');
            }
          },
          error: function (jqXHR, textStatus, errorThrown) {
            alert('网络错误，请稍后重试!');
          },
        });
      });
    });
  </script>
</body>
</html>